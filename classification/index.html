<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Classification (ganon classify) - ganon2</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Classification (ganon classify)";
        var mkdocs_page_input_path = "classification.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> ganon2
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">ganon2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../start/">Quick Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../default_databases/">Databases (ganon build)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../custom_databases/">Custom databases (ganon build-custom)</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Classification (ganon classify)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#profiling">Profiling</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#binning">Binning</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reads-with-multiple-matches">Reads with multiple matches</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#classifying-more-reads">Classifying more reads</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#multiple-and-hierarchical-classification">Multiple and Hierarchical classification</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parameter-details">Parameter details</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reads-single-reads-paired-reads">reads (--single-reads, --paired-reads)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cutoff-and-filter-rel-cutoff-rel-filter">cutoff and filter (--rel-cutoff, --rel-filter)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#false-positive-of-a-query-fpr-query">False positive of a query (--fpr-query)</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../reports/">Reports (ganon report)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../table/">Table (ganon table)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../outputfiles/">Output files</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tutorials/">Tutorials</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">ganon2</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Classification (ganon classify)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="classification">Classification<a class="headerlink" href="#classification" title="Permanent link">:)</a></h1>
<p><code>ganon classify</code> will match single and/or paired-end sets of reads against one or <a href="#multiple-and-hierarchical-classification">more databases</a>. 
By default, parameters are optimized for <strong>taxonomic profiling</strong>, meaning that less reads will be classified but with a higher sensitivity. For example:</p>
<pre><code class="language-bash">ganon classify --db-prefix my_db --paired-reads reads.1.fq.gz reads.2.fq.gz --output-prefix results --threads 32
</code></pre>
<p>Output files:</p>
<ul>
<li><code>results.rep</code>: plain report of the run, used to further generate tree-like reports</li>
<li><code>results.tre</code>: tree-like report with cumulative abundances by taxonomic ranks (can be re-generated with <code>ganon report</code>)</li>
</ul>
<p>By default, <code>ganon classify</code> only write report files. To get files with the classification of each read, use <code>--output-one</code> and/or <code>--output-all</code>. More information about output files <a href="../outputfiles/#ganon-classify">here</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ganon performs <strong>taxonomic profiling</strong> and/or <strong>binning</strong> (one tax. assignment for each read) at a taxonomic, strain or sequence level. Some guidelines are listed below, please choose the parameters according to your application.</p>
</div>
<h3 id="profiling">Profiling<a class="headerlink" href="#profiling" title="Permanent link">:)</a></h3>
<p><code>ganon classify</code> is set-up by default to perform taxonomic profiling. It uses:</p>
<ul>
<li>strict thresholds: <code>--rel-cutoff 0.75</code> and <code>--rel-filter 0.1</code></li>
<li><code>--min-count 0.00005</code> (0.005%) to exclude very low abundant taxa</li>
<li><code>--report-type abundance</code> to generate taxonomic abundances, correcting for genome sizes  (more infos <a href="../reports/#report-type-report-type">here</a>)</li>
</ul>
<h3 id="binning">Binning<a class="headerlink" href="#binning" title="Permanent link">:)</a></h3>
<p>To achieve better results for taxonomic binning or sequence classification, <code>ganon classify</code> can be configured with <code>--binning</code>, that is the same as:</p>
<ul>
<li>less strict thresholds: <code>--rel-cutoff 0.25 --rel-filter 0</code></li>
<li><code>--min-count 0</code> reports all taxa with at least one read assigned to it</li>
<li><code>--report-type reads</code> will report sequence abundances instead of taxonomic abundances (more infos <a href="../reports/#report-type-report-type">here</a>)</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Database parameters in <code>ganon build</code> can also influence your results. Lower <code>--max-fp</code> (e.g. 0.1, 0.001) and higher <code>--kmer-size</code> (e.g. <code>23</code>, <code>27</code>) will improve sensitivity of your results at cost of a larger database and memory usage.</p>
</div>
<h2 id="reads-with-multiple-matches">Reads with multiple matches<a class="headerlink" href="#reads-with-multiple-matches" title="Permanent link">:)</a></h2>
<p>There are two ways to solve reads with multiple-matches in <code>ganon classify</code>:</p>
<ul>
<li><code>--multiple-matches em</code> (default): uses an Expectation-Maximization algorithm, re-assigning reads with multiple matches to one most probable target (defined by <code>--level</code> in the build procedure).</li>
<li><code>--multiple-matches lca</code>: uses the Lowest Common Ancestor algorithm, re-assigning reads with multiple matches to higher common ancestors in the taxonomic tree.</li>
<li><code>--multiple-matches skip</code>: will not resolve multi-matching reads</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>The Expectation-Maximization can be performed independently with <code>ganon reassign</code> using the output files <code>.rep</code> and <code>.all</code>.</li>
<li>Reports can be generated independently with <code>ganon report</code> using the output file <code>.rep</code></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>--multiple-matches lca</code> paired with <code>--report-type abundance</code> or <code>dist</code> will distribute read <strong>counts</strong> with multiple matches to one most probable target (defined by <code>--level</code> in the build procedure), instead of a higher taxonomic rank. In this case the distribution is simply based on the number of taxa with unique matches and it is not as precise as the EM algorithm, but it will run faster since the per-read basis re-assignment can be skipped.</p>
</div>
<h2 id="classifying-more-reads">Classifying more reads<a class="headerlink" href="#classifying-more-reads" title="Permanent link">:)</a></h2>
<p>By default ganon will classify less reads in favour of sensitivity. To classify more reads, use less strict <code>--rel-cutoff</code> and <code>--rel-filter</code> values (e.g. <code>0.25</code> and <code>0</code>, respectively). More details <a href="#cutoff-and-filter-rel-cutoff-rel-filter">here</a>.</p>
<h2 id="multiple-and-hierarchical-classification">Multiple and Hierarchical classification<a class="headerlink" href="#multiple-and-hierarchical-classification" title="Permanent link">:)</a></h2>
<p><code>ganon classify</code> can be performed in multiple databases at the same time. The databases can also be provided in a hierarchical order. </p>
<p>Multiple database classification can be performed providing several inputs for <code>--db-prefix</code>. They are required to be built with the same <code>--kmer-size</code> and <code>--window-size</code> values. Multiple databases are considered as one (as if built together) and redundancy in content (same reference in two or more databases) is allowed.</p>
<p>To classify reads in a hierarchical order, <code>--hierarchy-labels</code> should be provided. When using multiple hierarchical levels, output files will be generated for each level (use <code>--output-single</code> to generate a single output from multiple hierarchical levels). Please note that some parameters are set for each database (e.g. <code>--rel-cutoff</code>) while others are set for each hierarchical level (e.g. <code>--rel-filter</code>)</p>
<details>
  <summary>Examples</summary>
  <br>
Classification against 3 database (as if they were one) using the same cutoff:


<pre><code class="language-bash">ganon classify --db-prefix db1 db2 db3 \
               --rel-cutoff 0.75 \
               --single-reads reads.fq.gz
</code></pre>


Classification against 3 database (as if they were one) using different error rates for each:


<pre><code class="language-bash">ganon classify --db-prefix  db1 db2 db3 \
               --rel-cutoff 0.2 0.3 0.1 \
               --single-reads reads.fq.gz
</code></pre>


In this example, reads are going to be classified first against db1 and db2. Reads without a valid match will be further classified against db3. `--hierarchy-labels` are strings and are going to be sorted to define the hierarchy order, disregarding input order:


<pre><code class="language-bash">ganon classify --db-prefix            db1     db2      db3 \
               --hierarchy-labels 1_first 1_first 2_second \
               --single-reads reads.fq.gz
</code></pre>


In this example, classification will be performed with different `--rel-cutoff` for each database. For each hierarchy levels (`1_first` and `2_second`) a different `--rel-filter` will be used:


<pre><code class="language-bash">ganon classify --db-prefix            db1     db2      db3 \
               --hierarchy-labels 1_first 1_first 2_second \
               --rel-cutoff             1     0.5     0.25 \
               --rel-filter           0.1              0.5 \
               --single-reads reads.fq.gz
</code></pre>


</details>
<p><br></p>
<h2 id="parameter-details">Parameter details<a class="headerlink" href="#parameter-details" title="Permanent link">:)</a></h2>
<h3 id="reads-single-reads-paired-reads">reads (--single-reads, --paired-reads)<a class="headerlink" href="#reads-single-reads-paired-reads" title="Permanent link">:)</a></h3>
<p>ganon accepts single-end and paired-end reads. Both types can be use at the same time. In paired-end mode, reads are always reported with the header of the first pair. Paired-end reads are classified in a standard forward-reverse orientation. The max. read length accepted is 65535 (accounting both reads in paired mode).</p>
<h3 id="cutoff-and-filter-rel-cutoff-rel-filter">cutoff and filter (--rel-cutoff, --rel-filter)<a class="headerlink" href="#cutoff-and-filter-rel-cutoff-rel-filter" title="Permanent link">:)</a></h3>
<p>ganon has two main parameters to control the number and strictess of matches between reads and references: <code>--rel-cutoff</code> and <code>--rel-filter</code>.</p>
<p>Every read can be classified against none, one or more references. ganon will report only matches after <code>cutoff</code> and <code>filter</code> thresholds are applied, based on the number of shared k-mers between sequences (use <code>--rel-cutoff 0</code> and <code>--rel-filter 1</code> to deactivate them).</p>
<p>The <code>cutoff</code> is the first to be applied. It sets the min. percentage of k-mers of a read to be shared with a reference to consider a match. Next the <code>filter</code> is applied to the remaining matches. <code>filter</code> thresholds are relative to the best and worst scoring match after <code>cutoff</code> and control the percentage of additional matches (if any) should be reported, sorted from the best to worst. <code>filter</code> won't change the total number of matched reads but will change the amount of unique or multi-matched reads.</p>
<p><code>cutoff</code> can be interpreted as the lower bound to discard spurious matches and <code>filter</code> as the fine tuning to control what to keep.</p>
<p>In summary:</p>
<ul>
<li><code>--rel-cutoff</code> controls the strictness of the matching algorithm.<ul>
<li><strong>lower</strong> values -&gt; <strong>more read matches</strong></li>
<li><strong>higher</strong> values -&gt; <strong>less read matches</strong></li>
</ul>
</li>
<li><code>--rel-filter</code> controls how many matches each read will have, from best to worst<ul>
<li><strong>lower</strong> values -&gt; <strong>more unique matching reads</strong></li>
<li><strong>higher</strong> values -&gt; <strong>more multi-matching reads</strong></li>
</ul>
</li>
</ul>
<p>For example, using a hypothetical number of k-mer matches, a certain read with 82 k-mers has the following matches with the 5 references (<code>ref1..5</code>), sorted number of shared k-mers:</p>
<table>
<thead>
<tr>
<th>reference</th>
<th>shared k-mers</th>
</tr>
</thead>
<tbody>
<tr>
<td>ref1</td>
<td>82</td>
</tr>
<tr>
<td>ref2</td>
<td>68</td>
</tr>
<tr>
<td>ref3</td>
<td>44</td>
</tr>
<tr>
<td>ref4</td>
<td>25</td>
</tr>
<tr>
<td>ref5</td>
<td>20</td>
</tr>
</tbody>
</table>
<p>With <code>--rel-cutoff 0.25</code>, the following matches will be discarded:</p>
<table>
<thead>
<tr>
<th>reference</th>
<th>shared k-mers</th>
<th>--rel-cutoff 0.25</th>
</tr>
</thead>
<tbody>
<tr>
<td>ref1</td>
<td>82</td>
<td></td>
</tr>
<tr>
<td>ref2</td>
<td>68</td>
<td></td>
</tr>
<tr>
<td>ref3</td>
<td>44</td>
<td></td>
</tr>
<tr>
<td>ref4</td>
<td>25</td>
<td></td>
</tr>
<tr>
<td>~~ref5~~</td>
<td>~~20~~</td>
<td>X</td>
</tr>
</tbody>
</table>
<p>since the <code>--rel-cutoff</code> threshold is <code>82 * 0.25 = 21</code> (ceiling is applied).</p>
<p>Next, with <code>--rel-filter 0.5</code>, the following matches will be discarded:</p>
<table>
<thead>
<tr>
<th>reference</th>
<th>shared k-mers</th>
<th>--rel-cutoff 0.25</th>
<th>--rel-filter 0.5</th>
</tr>
</thead>
<tbody>
<tr>
<td>ref1</td>
<td>82</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ref2</td>
<td>68</td>
<td></td>
<td></td>
</tr>
<tr>
<td>~~ref3~~</td>
<td>~~44~~</td>
<td></td>
<td>X</td>
</tr>
<tr>
<td>~~ref4~~</td>
<td>~~25~~</td>
<td></td>
<td>X</td>
</tr>
<tr>
<td>~~ref5~~</td>
<td>~~20~~</td>
<td>X</td>
<td></td>
</tr>
</tbody>
</table>
<p>since <code>82</code> is the best match and <code>25</code> is the worst remaining match, the filter will keep the top the remaining matches, based on the shared k-mers threshold <code>82 - ((82-25)*0.5) = 54</code> (ceiling is applied). <code>ref1</code> and <code>ref2</code> are reported as matches</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The actual number of unique k-mers in a read are used as an upper bound to calculate the thresholds. The same is applied when using <code>--window-size</code> and minimizers.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A different <code>--rel-cutoff</code> can be set for every database in a multiple or hierarchical database classification. A different <code>--rel-filter</code> can be set for every level of a hierarchical database classification.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reads that remain with only one reference match (after <code>cutoff</code> and <code>filter</code> are applied) are considered a unique match.</p>
</div>
<h3 id="false-positive-of-a-query-fpr-query">False positive of a query (--fpr-query)<a class="headerlink" href="#false-positive-of-a-query-fpr-query" title="Permanent link">:)</a></h3>
<p>ganon uses Bloom Filters, probabilistic data structures that may return false positive results. The base false positive of a ganon index is controlled by <code>--max-fp</code> when building the database. However, this value is the expected false positive for each k-mer. In practice, a sequence (several k-mers) will have a way smaller false positive. ganon calculates the false positive rate of a query as suggested by (Solomon and Kingsford, 2016). The <code>--fpr-query</code> will control the max. value accepted to consider a match between a sequence and a reference, avoiding false positives that may be introduce by the properties of the data structure. </p>
<p>By default, <code>--fpr-query 1e-5</code> is used and it is applied after the <code>--rel-cutoff</code> and <code>--rel-filter</code>. Values between <code>1e-3</code> and <code>1e-10</code> are recommended. This threshold becomes more important when building smaller databases with higher <code>--max-fp</code>, assuring that the false positive is under control. In this case however, sensitivity of results may decrease.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The false positive of a query was first propose in: Solomon, Brad, and Carl Kingsford. “Fast Search of Thousands of Short-Read Sequencing Experiments.” Nature Biotechnology 34, no. 3 (2016): 1–6. https://doi.org/10.1038/nbt.3442.</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../custom_databases/" class="btn btn-neutral float-left" title="Custom databases (ganon build-custom)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../reports/" class="btn btn-neutral float-right" title="Reports (ganon report)">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../custom_databases/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../reports/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../js/extra.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
